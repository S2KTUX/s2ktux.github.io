<script>
const terminal = document.getElementById("terminal");

const commands = {
  help: () => `
Available commands:
  help       Show this help
  about      About me
  skills     Technical skills
  projects   Show projects
  clear      Clear terminal
`,
  about: () => "Linux Systems Administrator focused on automation and infrastructure.",
  skills: () => "Linux | Bash | Networking | RHCSA | LPIC-1",
  projects: () => "1. Infra automation\n2. Server hardening\n3. Container labs",
  "ls -l": () => "total 3\n-rw-r--r-- projects\n-rw-r--r-- skills\n-rw-r--r-- about"
};

let history = [];
let historyIndex = 0;
let currentInput = "";
let inputLine;
let commandSpan;

function scrollBottom() {
  terminal.scrollTop = terminal.scrollHeight;
}

function print(text, className="output") {
  const line = document.createElement("div");
  line.className = "line " + className;
  line.textContent = text;
  terminal.appendChild(line);
  scrollBottom();
}

function newPrompt() {
  inputLine = document.createElement("div");
  inputLine.className = "input-line";

  const prompt = document.createElement("span");
  prompt.className = "prompt";
  prompt.textContent = "user@web:~$ ";

  commandSpan = document.createElement("span");
  commandSpan.className = "command";

  const cursor = document.createElement("span");
  cursor.className = "cursor";

  inputLine.appendChild(prompt);
  inputLine.appendChild(commandSpan);
  inputLine.appendChild(cursor);

  terminal.appendChild(inputLine);
  scrollBottom();
}

function executeCommand(cmd) {
  if (cmd === "clear") {
    terminal.innerHTML = "";
    newPrompt();
    return;
  }

  if (commands[cmd]) {
    print(commands[cmd]());
  } else if (cmd.trim() !== "") {
    print("Command not found: " + cmd, "error");
  }
}

document.addEventListener("keydown", function(e) {
  if (!commandSpan) return;

  // Ignorar combinaciones raras
  if (e.ctrlKey || e.metaKey || e.altKey) return;

  if (e.key === "Backspace") {
    e.preventDefault();
    currentInput = currentInput.slice(0, -1);
  }
  else if (e.key === "Enter") {
    e.preventDefault();

    // Convertir la lÃ­nea actual en fija
    commandSpan.textContent = currentInput;
    inputLine.querySelector(".cursor").remove();

    history.push(currentInput);
    historyIndex = history.length;

    executeCommand(currentInput.trim());

    currentInput = "";
    newPrompt();
    return;
  }
  else if (e.key === "ArrowUp") {
    e.preventDefault();
    if (historyIndex > 0) {
      historyIndex--;
      currentInput = history[historyIndex];
    }
  }
  else if (e.key === "ArrowDown") {
    e.preventDefault();
    if (historyIndex < history.length - 1) {
      historyIndex++;
      currentInput = history[historyIndex];
    } else {
      currentInput = "";
    }
  }
  else if (e.key.length === 1) {
    currentInput += e.key;
  }

  commandSpan.textContent = currentInput;
  scrollBottom();
});

newPrompt();
</script>
