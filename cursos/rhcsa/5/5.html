<div class="lesson-wrapper">
    <header class="lesson-header">
        <span class="badge">RHCSA Objetivo 5</span>
        <h1>Configuraci√≥n del almacenamiento local</h1>
        <p>Particiones, LVM y montaje persistente de sistemas de archivos</p>
        
        <a href="https://youtu.be/RMWPYC6xllw" target="_blank" class="video-card">
            <div class="video-icon">üé¨</div>
            <div class="video-text">
                <strong>VER VIDEO YOUTUBE - CLASE 5</strong>
                <span>Almacenamiento local paso a paso para RHCSA</span>
            </div>
        </a>
    </header>

    <div class="lesson-layout">

        <aside class="lesson-toc">
            <h4>Objetivos del bloque</h4>
            <ul>
                <li><a href="#obj1">1. Particiones GPT</a></li>
                <li><a href="#obj2">2. Vol√∫menes f√≠sicos (PV)</a></li>
                <li><a href="#obj3">3. Grupos de vol√∫menes (VG)</a></li>
                <li><a href="#obj4">4. Vol√∫menes l√≥gicos (LV)</a></li>
                <li><a href="#obj5">5. Montaje con UUID o LABEL</a></li>
                <li><a href="#obj6">6. Cambios no destructivos y SWAP</a></li>
            </ul>
        </aside>
        

        <div class="course-content">

            <section id="obj1" class="lesson-section">
                <h3>1. Listar, crear y eliminar particiones GPT</h3>
                <p>Antes de poder utilizar un disco debemos crear particiones. El est√°ndar actual es <strong>GPT</strong>, que sustituye a MBR, aunque este se sigue usando.</p>
                <p> Las diferencias principales entre MBR y GPT son que MBR est√° limitado a 2TB y 4 particiones, mientras que GPT  permite discos m√°s grandes, particiones casi ilimitadas y mayor recuperaci√≥n de datos.</p>
                <p> Para listar los discos o particiones que tenemos podemos usar los siguientes comandos, que cualquiera es valido para hacer comprobaciones : </p>
                <ul>
                    <li><strong>lsblk</strong> ‚Üí Vista clara de discos y particiones.</li>
                    <li><strong>blkid</strong> ‚Üí UUID y tipo de filesystem.</li>
                    <li><strong>parted -l</strong> ‚Üí Informaci√≥n de tabla GPT/MBR.</li>
                    <li><strong>fdisk -l</strong> ‚Üí Informaci√≥n t√©cnica detallada.</li>
                    <li><strong>df -h</strong> ‚Üí Espacio usado en sistemas montados.</li>
                </ul>
                <p>Las particiones pueden gestionarse con <code>fdisk</code>, <code>gdisk</code> o <code>parted</code> (recomendado en Red Hat). Tras modificar particiones ejecutamos <code>partprobe</code> para actualizar el kernel.</p>
                <img src="/images/listado-part.png">
                <p>Una vez listados los discos, podemos crear o eliminar particiones usando <code>fdisk</code>, <code>gdisk</code> o <code>parted</code>. Tened en cuenta que  gdisk funciona practicamente igual que fdisk.</p>
                <p>Para usar <code>fdisk</code> ejecutamos <code>fdisk /dev/sdX</code> (el disco se obtiene con <code>fdisk -l</code>) y desde el men√∫ interactivo podemos crear o borrar particiones.</p>
                <img src="/images/part-fdisk.png" alt="Creaci√≥n de particiones con fdisk">
                <p>Con <code>n</code> creamos particiones, con <code>d</code> las eliminamos y con <code>t</code> cambiamos su tipo.</p>
                <img src="/images/mod-tipo-part-fdisk.png" alt="Cambio de tipo de partici√≥n a LVM">
                <p> Por otro lado, podemos utilizar parted que. Escribiendo help vemos todas las opciones. Por ejemplo vamos a crear varias particiones : </p>
                <img src="/images/parted-all.png" alt="Crear parted particiones ejemplo">
                <p>Primero creamos la tabla de particiones GPT, despu√©s la partici√≥n y, si es necesario, le asignamos el tipo. Recuerda que el inicio de la primera partici√≥n es <strong>1MiB</strong>.</p>
                <p>Al salir de <code>parted</code> es necesario ejecutar <code>partprobe -s</code> para que el sistema detecte los cambios. Luego podemos comprobar las particiones con comandos como <code>lsblk</code>. </p>
                <p> Por ultimo, aunque no muy relevante pero si podr√≠a salir en el examen, existen unas etiquetas INTERNAS de las tablas de GPT. Podemos asignarlas con el comando <code>parted disco name 1(partici√≥n) "NOMBRE"</code>. No confundir estas etiquetas con las etiquetas de las particiones que veremos despues.</p>


            </section>

            <section id="obj2" class="lesson-section">
                <h3>2. Crear y eliminar vol√∫menes f√≠sicos (PV)</h3>
                <p>LVM organiza el almacenamiento en tres capas: <strong>PV ‚Üí VG ‚Üí LV</strong>. Un volumen f√≠sico es una partici√≥n o disco preparado para LVM.</p>
                <p> Por ejemplo, vamos a crear dos PV, borrar uno y comprobar(pvs o pvdisplay para m√°s informaci√≥n) :</p>
                <img src="/images/pv-ex.png" alt="pv ejemplo">
                <p>Es importante que la partici√≥n tenga tipo LVM antes de crear el PV.</p>
            </section>

            <section id="obj3" class="lesson-section">
                <h3>3. Crear y gestionar grupos de vol√∫menes (VG)</h3>
                <p>Un <strong>Volume Group</strong> combina varios PV creando un espacio de almacenamiento com√∫n.</p>
                <p> En los VG entra el concepto de PE que es la unidad basica de almacenamiento en LVM. Nosotros asignamos X tama√±o pero internamente LVM utilizar√° los PE. Por defecto son 4MB, entonces si por ejemplo tenemos 10GB, LVM usar√° 2560PE (10GIB / 4MB)</p>
                <img src="/images/vg-ex.png" alt="vg ejemplo" >
                <p> Vemos com hemos creado, extendido, reducido y borrado VG, as√≠ como comprobado con vgs o vgdisplay. Por ultimo, podriamos activar o desactivar con <code>vgchange -ay/-an nombre-VG</code>, siendo -ay para activar y -an para desactivar</p>
        
            </section>

            <section id="obj4" class="lesson-section">
                <h3>4. Crear y administrar vol√∫menes l√≥gicos (LV)</h3>
                <p>Los vol√∫menes l√≥gicos son los dispositivos finales que se formatean y montan en el sistema.</p>
                <p> Para crear un volumen l√≥gico (LV) podemos indicar el tama√±o en gigabytes con <code>-L</code> o usando extensiones f√≠sicas (PE) con <code>-l</code> y le daremos un nombre con <code>-n</code>. Por ejemplo:</p>
                <img src="/images/lv-primera.png" alt="lv ejemplo" >
                <p> Una vez creados, podemos extender, reducir, borrar... Pero primeramente vamos a darle un formato y montandolos en el sistema para identificarlos. Recordar comprobar con lsblk, df -Th, lvs ...</p>
                <img src="/images/lv_segunda.png" alt="lv-formatear y montar ejemplo">
                <p> Una vez formateados y montados, ya podriamos extender y reducir, aunque para reducir deben estan DESMONTADOS. Al extender, si a√±adimos <code>-r</code> se extender√° automaticamente. En caso de que no lo a√±adamos, tendriamos que ejecutar resize2fs (para ext4) o xfs_growfs (para XFS)  </p>
                <img src="/images/lv_tercera.png" alt="lv extend ejemplo" >
                <img src="/images/lv_cuarta.png" alt="lv reduce ejemplo">
                <p> Importante mencionar que extender podemos con todos los filesystem pero REDUCIR no es posible con algunos como xfs y cuando reducimos indicamos el tama√±o final que queremos. Tambien podriamos  extender usando % de espacio libre con <code>lvextend -r -l +50%FREE particion</code>. </p>
            </section>

            <section id="obj5" class="lesson-section">
                <h3>5. Montar sistemas de archivos usando UUID o LABEL</h3>
                <p>El montaje persistente se configura en <code>/etc/fstab</code>. Se recomienda usar <strong>UUID</strong> o <strong>LABEL</strong> para evitar problemas si cambia el nombre del dispositivo.</p>
                <p> En cuanto las LABEL(etiquetas) podemos asignarlas de diferentes maneras </p>
                <ul>
                    <li><code>mkfs.ext4 -L NOMBRE DISCO</code> ‚Üí Crear filesystem con etiqueta. Es la m√°s recomendada</li>
                    <li><code>tune2fs -L</code> ‚Üí Cambiar etiqueta en EXT.</li>
                    <li><code>swaplabel -L</code> ‚Üí Etiquetar SWAP.</li>
                    <li><code>blkid</code> ‚Üí Obtener UUID.</li>
                </ul>
                <p> La sintaxis para montar un sistema de archivos de forma automatica al arrancar el sistema es : <code>[dispositivo] [montaje] [fs] [opciones] [dump] [pass]</code> (donde dump es siempre 0 y pass(verificar un filesystem al arrancar) suele ser 0 (no verificar) o 2 (verificar en segundo lugar). Las opciones, si no dicen lo contrario, usar defaults</p>
                <img src="/images/fstab.png" alt="lv reduce ejemplo" >
                <p>Tras modificarlo, lanzamos <code>mount -a</code> y  systemctl daemon-reload y .</p>
            </section>

                <section id="obj6" class="lesson-section">
                <h3>6. Cambios no destructivos y configuraci√≥n SWAP</h3>
                <p>Los cambios no destructivos consisten en ampliar almacenamiento sin perder datos mediante <code>vgextend</code> y <code>lvextend -r</code>. Reducir incorrectamente puede provocar p√©rdida de informaci√≥n.</p>
                <p> Uno de los mayores errores que hace que sea destructivo es una vez hemos extendido o reducido, formatear el disco <code>mkfs</code>, ya que borrar√≠a todos los datos. El otro error ser√≠a borrar la tabla de particiones o la partici√≥n con <code>fdisk</code> o <code>parted</code>.</p>
                <p> El SWAP es una zona del disco duro que el sistema utiliza como "memoria RAM de emergencia" cuando la principal se queda sin espacio. Teniamos creada la primera partici√≥n como swap en el punto 1. Para formatearla deberiamos de :  </p>
                <img src="/images/swap.png" alt="lv reduce ejemplo" >
                <p> Hemos creado la partici√≥n SWAP, le hemos dado formato y la hemos activo. Por ultimo, a√±adiendola a <code>/etc/fstab</code> la hacemos persistente. Tambien podr√≠amos crear SWAP a traves de archivo aunque dudo mucho que salga en el examen. En caso de ser√≠a :</p>
                <pre><code>
<pre><code>
fallocate -l 1G /swapfile #FORMA RAPIDA
dd if=/dev/zero of=/swapfile bs=1M count=1024 # FORMA LENTA 
    
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
echo "/swapfile swap swap defaults 0 0" >> /etc/fstab</code></pre>
                </code></pre>
            </section>

        </div>
    </div>
</div>
